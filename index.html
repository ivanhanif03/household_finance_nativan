<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Keuangan Rumah Tangga Nativan</title>

    <link rel="icon" href="assets/icons/icon-192.png" type="image/png" />
    <link rel="apple-touch-icon" href="assets/icons/icon-512.png" />
    <meta name="apple-mobile-web-app-status-bar" content="#7b2cbf" />

    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#0850d6" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Poppins", sans-serif;
        background: linear-gradient(145deg, #e0f0ff, #f7f7f7, #f3f3f3);
        color: #000;
        min-height: 100vh;
        padding-bottom: 100px;
      }

      .container {
        max-width: 700px;
        padding: 0 15px;
      }

      .title {
        font-weight: 700;
        font-size: clamp(1.3rem, 4vw, 1.8rem);
        text-align: center;
        margin: 25px 0 15px 0;
        color: #1a3d7c;
      }

      .balance {
        background: #0850d6;
        border-radius: 20px;
        padding: 20px;
        text-align: center;
        color: #fff;
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
      }

      .sub-balances {
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 15px;
      }

      .sub-balance {
        background: rgba(255, 255, 255, 0.15);
        border-radius: 12px;
        flex: 1;
        min-width: 30%;
        padding: 8px;
        font-size: 0.85rem;
        text-align: center;
        color: #fff;
      }

      .summary-card {
        background: #fff;
        border-radius: 16px;
        padding: 15px;
        text-align: center;
        color: #222;
        margin-bottom: 12px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      }

      .summary-card h6 {
        font-size: 0.85rem;
        color: #666;
        margin-bottom: 3px;
      }

      .summary-card h3 {
        font-size: 1.1rem;
        font-weight: 700;
        margin: 0;
        color: #1a3d7c;
      }

      .form-card {
        background: #fff;
        color: #333;
        border-radius: 18px;
        padding: 18px;
        margin-top: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .btn-blue {
        background-color: #0850d6;
        color: #fff;
        font-weight: 600;
        border-radius: 10px;
        width: 100%;
        transition: all 0.2s;
      }

      .btn-blue:hover {
        background-color: #00439b;
        color: #fff;
        transform: scale(1.02);
      }

      .riwayat-title {
        font-weight: 600;
        color: #1a3d7c;
        text-align: center;
        margin-top: 35px;
        margin-bottom: 10px;
        font-size: clamp(1rem, 3vw, 1.3rem);
      }

      .filter-export {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 14px;
        padding: 10px 14px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      }

      #filter {
        flex: 1;
        border-radius: 12px;
        border: none;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        padding: 8px 14px;
        font-size: 0.9rem;
      }

      #filter:focus {
        outline: none;
        box-shadow: 0 0 0 2px #90cfff;
      }

      .btn-export {
        background: #22a707;
        color: white;
        font-weight: 500;
        border: none;
        padding: 8px 14px;
        border-radius: 10px;
        transition: 0.2s;
      }

      .btn-export:hover {
        opacity: 0.9;
        transform: scale(1.03);
      }

      .tanggal-filter {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 12px;
      }

      .tanggal-filter input[type="date"] {
        border-radius: 10px;
        border: none;
        font-size: 0.85rem;
        padding: 6px 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        min-width: 130px;
      }

      .tanggal-filter button {
        border-radius: 10px;
        background-color: #fff;
        color: #1a3d7c;
        border: none;
        padding: 6px 10px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        transition: 0.2s;
      }

      .tanggal-filter button:hover {
        transform: scale(1.05);
        background-color: #e0f0ff;
      }

      #notif {
        color: #1a73e8;
        font-size: 0.9rem;
        text-align: center;
      }

      .riwayat-container {
        margin-top: 20px;
      }

      .trx-card {
        background: #fff;
        color: #333;
        border-radius: 14px;
        padding: 10px 14px;
        margin-bottom: 10px;
        box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        gap: 4px;
        transition: transform 0.2s ease;
      }

      .trx-card:hover {
        transform: translateY(-2px);
      }

      .trx-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px dashed #eee;
        padding-bottom: 3px;
      }

      .trx-header h6 {
        margin: 0;
        font-weight: 600;
        color: #1a3d7c;
        font-size: 0.9rem;
        text-transform: uppercase;
      }

      .trx-date {
        font-size: 0.75rem;
        color: #555;
      }

      .trx-detail {
        font-size: 0.83rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 2px;
      }

      .trx-nominal {
        font-weight: 700;
      }

      .trx-nominal.pendapatan {
        color: #3cb902;
      }

      .trx-nominal.pengeluaran {
        color: #e63946;
      }

      #totalPengeluaran {
        color: #e63946;
      }

      #totalPendapatan {
        color: #3cb902;
      }

      .trx-deskripsi {
        color: #555;
        font-size: 0.8rem;
        font-style: italic;
      }

      /* 🔄 Loading overlay */
      #loadingOverlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.8);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }

      .spinner {
        border: 5px solid #ddd;
        border-top: 5px solid #1a3d7c;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 0.8s linear infinite;
      }

      .toast {
        position: fixed; /* agar tetap di viewport */
        top: 20px; /* jarak dari atas */
        left: 50%; /* center horizontal */
        transform: translateX(-50%) translateY(-20px); /* center dan efek animasi */
        background-color: #ec1f1f;
        color: #fff;
        padding: 12px 20px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        min-width: 220px;
        max-width: 300px;
        font-size: 0.9rem;
        opacity: 0;
        transition: all 0.4s ease;
        z-index: 9999; /* pastikan di atas elemen lain */
        text-align: center; /* teks di tengah */
      }

      .toast.show {
        opacity: 1;
        transform: translateX(-50%) translateY(0); /* animasi slide dari atas */
      }

      #overlayToast {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.7);
        background-color: #22a707;
        color: #fff;
        padding: 16px 24px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        font-size: 1rem;
        opacity: 0;
        transition: all 0.4s ease;
        z-index: 10000;
        text-align: center;
      }

      #overlayToast.show {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }

      @media (max-width: 500px) {
        .filter-export {
          flex-direction: column;
          align-items: stretch;
        }

        .btn-export {
          width: 100%;
        }

        .tanggal-filter {
          flex-direction: column;
        }

        .trx-header {
          flex-direction: column;
          align-items: flex-start;
          gap: 2px;
        }
      }
    </style>
  </head>

  <body>
    <!-- 🔄 Loading overlay -->
    <div id="loadingOverlay">
      <div class="spinner"></div>
      <div id="overlayToast">
        <span id="overlayToastText">✅ Input berhasil!</span>
      </div>
    </div>

    <div class="container">
      <!-- Toast Notification -->
      <div
        id="toastContainer"
        style="position: fixed; top: 20px; right: 20px; z-index: 9999"
      ></div>
      <div class="title">💰 Keuangan Rumah Tangga Nativan</div>

      <div class="balance mb-3">
        <h5>Saldo Total</h5>
        <h2 id="saldo">Rp 0</h2>
        <div class="sub-balances">
          <div class="sub-balance" onclick="tampilkanDetailSaldo('Cash')">
            Cash<br /><span id="saldoCash">Rp 0</span>
          </div>
          <div class="sub-balance" onclick="tampilkanDetailSaldo('M-Banking')">
            M-Banking<br /><span id="saldoBank">Rp 0</span>
          </div>
          <div class="sub-balance" onclick="tampilkanDetailSaldo('E-Wallet')">
            E-Wallet<br /><span id="saldoWallet">Rp 0</span>
          </div>
        </div>

        <div class="detail-wrapper mt-3">
          <div
            id="detailSaldoContainer"
            style="overflow: hidden; height: 0; transition: height 0.4s ease"
          ></div>
        </div>
      </div>

      <div class="row text-center mb-3">
        <div class="col-6">
          <div class="summary-card">
            <h6>Pendapatan</h6>
            <h3 id="totalPendapatan">Rp 0</h3>
          </div>
        </div>
        <div class="col-6">
          <div class="summary-card">
            <h6>Pengeluaran</h6>
            <h3 id="totalPengeluaran">Rp 0</h3>
          </div>
        </div>
      </div>

      <div class="form-card">
        <h5 class="fw-bold mb-3 text-center" style="color: #04215f">
          Tambah Transaksi
        </h5>
        <div class="mb-3">
          <label class="form-label">Jenis</label>
          <select id="jenis" class="form-select">
            <option value="Pendapatan">Pendapatan</option>
            <option value="Pengeluaran">Pengeluaran</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Kategori</label
          ><input
            type="text"
            id="kategori"
            class="form-control"
            placeholder="Contoh: Gaji, Makan, Transport"
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Nominal</label
          ><input
            type="text"
            id="nominal"
            class="form-control"
            placeholder="Contoh: 1.500.000"
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Deskripsi</label
          ><input
            type="text"
            id="deskripsi"
            class="form-control"
            placeholder="Keterangan tambahan"
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Kepemilikan</label>
          <select id="kepemilikan" class="form-select">
            <option value="Ayah">Ayah</option>
            <option value="Ibun">Ibun</option>
            <option value="Izora">Izora</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label">Dompet</label>
          <select id="dompet" class="form-select">
            <option value="Cash">Cash</option>
            <option value="M-Banking">M-Banking</option>
            <option value="E-Wallet">E-Wallet</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label">Detail Dompet</label>
          <select id="dompetDetail" class="form-select">
            <option value="">-- Pilih --</option>
          </select>
        </div>
        <button class="btn btn-blue" onclick="simpanTransaksi()">Simpan</button>
        <div id="notif" class="mt-3 fw-semibold"></div>
      </div>

      <div class="riwayat-title">📜 Riwayat Transaksi</div>

      <div class="filter-export">
        <input
          type="text"
          id="filter"
          placeholder="Cari transaksi..."
          onkeyup="filterTable()"
        />
        <button class="btn-export" onclick="exportExcel()">
          📤 Export Excel
        </button>
      </div>

      <div class="tanggal-filter flex-wrap flex-md-nowrap">
        <div class="d-flex w-100 gap-2 justify-content-center">
          <input type="date" id="startDate" class="flex-fill" />
          <input type="date" id="endDate" class="flex-fill" />
          <button onclick="filterTanggal()">🔍</button>
        </div>
      </div>

      <div class="riwayat-container" id="riwayatContainer"></div>
    </div>

    <script>
      const SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbw6k_zAJQbu-y37sV0FYecQTc9F3Wo_SZ7IhteJrSWmLHhb50vYbYchGPlb_3WNWml9/exec";
      let semuaData = [];

      const showLoading = (show = true) => {
        document.getElementById("loadingOverlay").style.display = show
          ? "flex"
          : "none";
      };

      const formatRupiah = (angka) =>
        "Rp " + angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
      const formatTanggal = (t) => {
        const d = new Date(t);
        if (isNaN(d)) return "-";
        return `${d.getDate().toString().padStart(2, "0")}/${(d.getMonth() + 1)
          .toString()
          .padStart(2, "0")}/${d.getFullYear()} ${d
          .getHours()
          .toString()
          .padStart(2, "0")}:${d.getMinutes().toString().padStart(2, "0")}`;
      };

      document.getElementById("nominal").addEventListener("input", (e) => {
        e.target.value = e.target.value
          .replace(/\D/g, "")
          .replace(/\B(?=(\d{3})+(?!\d))/g, ".");
      });

      function capitalizeFirst(str) {
        return str
          ? str.charAt(0).toUpperCase() + str.slice(1).toLowerCase()
          : "";
      }

      function showNotif(msg) {
        const n = document.getElementById("notif");
        n.innerText = msg;
        setTimeout(() => (n.innerText = ""), 3000);
      }

      const jenisEl = document.getElementById("jenis");
      const kategoriEl = document.getElementById("kategori");
      const nominalEl = document.getElementById("nominal");
      const deskripsiEl = document.getElementById("deskripsi");
      const dompetEl = document.getElementById("dompet");
      const kepemilikanEl = document.getElementById("kepemilikan");

      const dompetDetailEl = document.getElementById("dompetDetail");

      const detailOptions = {
        Cash: ["Cash"],
        "M-Banking": ["BTN", "Mandiri", "BRI", "BSI"],
        "E-Wallet": ["Gopay", "Dana", "OVO", "ShopeePay", "LinkAja"],
      };

      // Update dropdown detail dompet saat dompet dipilih
      dompetEl.addEventListener("change", () => {
        const dompet = dompetEl.value;
        const options = detailOptions[dompet] || [];
        dompetDetailEl.innerHTML = '<option value="">-- Pilih --</option>'; // reset

        options.forEach((opt) => {
          const el = document.createElement("option");
          el.value = opt;
          el.textContent = opt;
          dompetDetailEl.appendChild(el);
        });
      });

      async function simpanTransaksi() {
        const jenis = jenisEl.value,
          kategori = kategoriEl.value,
          nominal = nominalEl.value.replace(/\./g, ""),
          deskripsi = deskripsiEl.value,
          dompet = dompetEl.value,
          kepemilikan = kepemilikanEl.value,
          dompetDetail = dompetDetailEl.value;

        if (!kategori || !nominal)
          return showToast("Lengkapi kategori dan nominal!", 3000, "error");

        // spinner aktif
        showLoading(true);

        await fetch(SCRIPT_URL, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            jenis,
            kategori,
            nominal,
            deskripsi,
            dompet,
            dompetDetail,
            kepemilikan,
          }),
        });

        // spinner hilang
        showLoading(false);

        // toast muncul setelah spinner hilang
        setTimeout(() => showOverlayToast("✅ Transaksi berhasil!"), 200);

        loadData();
        kategoriEl.value = nominalEl.value = deskripsiEl.value = "";
        dompetDetailEl.value = "";
      }

      async function loadData() {
        showLoading(true);
        const res = await fetch(SCRIPT_URL);
        const data = await res.json();
        semuaData = data;
        renderDashboard();
        renderRiwayat(filter3HariTerakhir(data));
        showLoading(false);
      }

      function filter3HariTerakhir(data) {
        const now = new Date();
        const tigaHariLalu = new Date(now);
        tigaHariLalu.setDate(now.getDate() - 3);
        return data.filter((t) => new Date(t.tanggal) >= tigaHariLalu);
      }

      function filterTanggal() {
        const s = document.getElementById("startDate").value;
        const e = document.getElementById("endDate").value;
        if (!s || !e) return showToast("Pilih tanggal awal dan akhir!");
        const start = new Date(s);
        const end = new Date(e);
        end.setHours(23, 59, 59, 999);
        const filtered = semuaData.filter((t) => {
          const td = new Date(t.tanggal);
          return td >= start && td <= end;
        });
        renderRiwayat(filtered);
      }

      function renderDashboard() {
        let pendapatan = 0,
          pengeluaran = 0,
          cash = 0,
          bank = 0,
          wallet = 0;
        semuaData.forEach((trx) => {
          const n = parseInt(trx.nominal);
          if (trx.jenis === "Pendapatan") {
            pendapatan += n;
            if (trx.dompet === "Cash") cash += n;
            else if (trx.dompet === "M-Banking") bank += n;
            else wallet += n;
          } else {
            pengeluaran += n;
            if (trx.dompet === "Cash") cash -= n;
            else if (trx.dompet === "M-Banking") bank -= n;
            else wallet -= n;
          }
        });
        document.getElementById("totalPendapatan").innerText =
          formatRupiah(pendapatan);
        document.getElementById("totalPengeluaran").innerText =
          formatRupiah(pengeluaran);
        document.getElementById("saldo").innerText = formatRupiah(
          pendapatan - pengeluaran
        );
        document.getElementById("saldoCash").innerText = formatRupiah(cash);
        document.getElementById("saldoBank").innerText = formatRupiah(bank);
        document.getElementById("saldoWallet").innerText = formatRupiah(wallet);
      }

      let detailOpen = null;
      const container = document.getElementById("detailSaldoContainer");

      document.querySelectorAll(".sub-balance").forEach((card) => {
        card.addEventListener("click", () => {
          const tipe = card.textContent.includes("Cash")
            ? "Cash"
            : card.textContent.includes("M-Banking")
            ? "M-Banking"
            : "E-Wallet";
          toggleDetail(tipe);
        });
      });

      function toggleDetail(tipe) {
        if (detailOpen === tipe) {
          // tutup
          container.style.height = "0";
          detailOpen = null;
        } else {
          // isi detail
          container.innerHTML = "";
          const dataFiltered = semuaData.filter((t) => t.dompet === tipe);
          if (dataFiltered.length === 0) {
            container.innerHTML = `<p class="text-center">Tidak ada data untuk ${tipe}</p>`;
          } else {
            const summary = {};
            dataFiltered.forEach((t) => {
              const key = `${t.kepemilikan} - ${t.dompetDetail}`;
              summary[key] =
                (summary[key] || 0) +
                (t.jenis === "Pendapatan"
                  ? parseInt(t.nominal)
                  : -parseInt(t.nominal));
            });
            Object.entries(summary).forEach(([k, v]) => {
              const card = document.createElement("div");
              card.className = "summary-card mb-2";
              card.innerHTML = `<h6>${k}</h6><h3>${formatRupiah(v)}</h3>`;
              container.appendChild(card);
            });
          }

          // tampilkan slide down
          container.style.display = "block";
          const scrollH = container.scrollHeight;
          container.style.height = scrollH + "px";
          detailOpen = tipe;
        }
      }

      function renderRiwayat(data) {
        const container = document.getElementById("riwayatContainer");
        container.innerHTML = "";
        if (data.length === 0) {
          container.innerHTML =
            "<p class='text-center mt-3'>Tidak ada transaksi.</p>";
          return;
        }
        data
          .slice()
          .reverse()
          .forEach((trx) => {
            container.innerHTML += `
      <div class="trx-card">
        <div class="trx-header">
          <h6>${trx.kategori.toUpperCase()}</h6>
          <span class="trx-date">${formatTanggal(trx.tanggal)}</span>
        </div>
        <div class="trx-detail">
          <span>${trx.jenis} • ${trx.kepemilikan} • ${trx.dompet} (${
              trx.dompetDetail
            })</span>
          <span class="trx-nominal ${trx.jenis.toLowerCase()}">${formatRupiah(
              trx.nominal
            )}</span>
        </div>
        <small class="trx-deskripsi">${capitalizeFirst(
          trx.deskripsi || "-"
        )}</small>
      </div>`;
          });
      }

      function filterTable() {
        const keyword = document.getElementById("filter").value.toLowerCase();
        const filtered = semuaData.filter((t) =>
          (t.kategori + t.dompet + t.jenis + t.deskripsi)
            .toLowerCase()
            .includes(keyword)
        );
        renderRiwayat(filtered);
      }

      function showToast(message, duration = 3000, type = "info") {
        const container = document.getElementById("toastContainer");
        const toast = document.createElement("div");
        toast.className = "toast";
        toast.innerText = message;

        // optional: warna berbeda untuk type
        if (type === "error") toast.style.backgroundColor = "#e63946";
        else if (type === "success") toast.style.backgroundColor = "#22a707";

        container.appendChild(toast);

        // tampilkan animasi
        requestAnimationFrame(() => toast.classList.add("show"));

        // hilangkan otomatis
        setTimeout(() => {
          toast.classList.remove("show");
          toast.addEventListener("transitionend", () => toast.remove());
        }, duration);
      }

      let overlayToastVisible = false;

      function showOverlayToast(message = "✅ Berhasil!", duration = 1500) {
        if (overlayToastVisible) return;

        overlayToastVisible = true;
        const toast = document.getElementById("overlayToast");
        document.getElementById("overlayToastText").innerText = message;

        toast.classList.remove("show");
        toast.offsetWidth; // trigger reflow
        toast.classList.add("show");

        setTimeout(() => {
          toast.classList.remove("show");
          overlayToastVisible = false;
        }, duration);
      }

      function exportExcel() {
        const keyword = document.getElementById("filter").value.toLowerCase();
        const startDateVal = document.getElementById("startDate").value;
        const endDateVal = document.getElementById("endDate").value;
        let filtered = semuaData.slice();

        if (keyword) {
          filtered = filtered.filter((t) =>
            (t.kategori + t.dompet + t.jenis + t.deskripsi)
              .toLowerCase()
              .includes(keyword)
          );
        }

        if (startDateVal && endDateVal) {
          const start = new Date(startDateVal);
          const end = new Date(endDateVal);
          end.setHours(23, 59, 59, 999);
          filtered = filtered.filter((t) => {
            const td = new Date(t.tanggal);
            return td >= start && td <= end;
          });
        }

        if (filtered.length === 0) {
          showToast("Tidak ada data untuk diekspor!");
          return;
        }

        // Fungsi format tanggal
        const formatTanggalExcel = (t) => {
          const d = new Date(t);
          if (isNaN(d)) return "-";
          return `${d.getDate().toString().padStart(2, "0")}/${(
            d.getMonth() + 1
          )
            .toString()
            .padStart(2, "0")}/${d.getFullYear()} ${d
            .getHours()
            .toString()
            .padStart(2, "0")}:${d.getMinutes().toString().padStart(2, "0")}`;
        };

        // Buat header kolom CSV
        let csv = "Jenis,Kategori,Nominal,Deskripsi,Dompet,Tanggal\n";

        // Isi data CSV dengan format tanggal yang sudah diperbaiki
        filtered.forEach((trx) => {
          csv += `${trx.jenis},${trx.kategori},${trx.nominal},"${
            trx.deskripsi
          }",${trx.dompet},${formatTanggalExcel(trx.tanggal)}\n`;
        });

        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "keuangan_nativan.csv";
        a.click();
        URL.revokeObjectURL(url);
      }

      if ("serviceWorker" in navigator)
        navigator.serviceWorker.register("sw.js");

      loadData();
      // setInterval(loadData, 30000);
    </script>
  </body>
</html>
